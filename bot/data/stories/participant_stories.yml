version: "3.1"

stories:

  - story: participant join conversation on telegram
    steps:
      - intent: start_with_conversation_id
      - slot_was_set:
        - conversation_id
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: action_setup_user
      - checkpoint: starts_introduction
  
  - story: participant join conversation on telegram without conversation_id
    steps:
      - intent: welcome
      - slot_was_set:
        - conversation_id: 1
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: action_setup_user
      - checkpoint: starts_introduction
  
  - story: participant join conversation on telegram
    steps:
      - intent: start_with_conversation_id
      - slot_was_set:
        - conversation_id
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'whatsapp'
      - action: action_setup_user
      - checkpoint: starts_introduction
  
  - story: participant join conversation on telegram without conversation_id
    steps:
      - intent: welcome
      - slot_was_set:
        - conversation_id: 1
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'whatsapp'
      - action: action_setup_user
      - checkpoint: starts_introduction
  
  - story: start introduction to user can vote
    steps:
      - checkpoint: starts_introduction
      - action: utter_presentation
      - action: utter_show_topic
      - slot_was_set:
        - user_is_anonymous: False
      - checkpoint: starts_voting
  
  - story: start introduction to user can vote and is authenticated
    steps:
      - checkpoint: starts_introduction
      - action: utter_presentation
      - action: utter_show_topic
      - slot_was_set:
        - user_is_anonymous: True
      - action: action_check_user_can_vote
      - slot_was_set:
        - user_can_vote: True
      - checkpoint: starts_voting
  
  - story: start introduction to user can't vote
    steps:
      - checkpoint: starts_introduction
      - action: utter_presentation
      - action: utter_show_topic
      - slot_was_set:
        - user_is_anonymous: True
      - action: action_check_user_can_vote
      - slot_was_set:
        - user_can_vote: False
      - checkpoint: need_authentication
  
  - story: authentication is needed and successfully authenticated
    steps:
      - checkpoint: need_authentication
      - action: action_get_auth_link
      - action: utter_get_token
      - action: utter_awaiting_authentication
      - intent: check_authentication
      - action: action_setup_user
      - slot_was_set:
        - user_is_anonymous: False
      - checkpoint: starts_voting
  
  - story: authentication is needed and not authenticated
    steps:
      - checkpoint: need_authentication
      - action: action_get_auth_link
      - action: utter_get_token
      - action: utter_awaiting_authentication
      - intent: check_authentication
      - action: action_setup_user
      - slot_was_set:
        - user_is_anonymous: True
      - checkpoint: need_authentication
  
  - story: user wants to stop the conversation
    steps:
      - intent: stop
      - action: utter_finish

  - story: starts voting form and accepts to add a new comment
    steps:
      - checkpoint: starts_voting
      - slot_was_set:
        - conversation_id
      - action: vote_form
      - active_loop: vote_form
      - slot_was_set:
        - comment_confirmation: Sim
      - action: utter_ask_comment
      - action: vote_form
      - active_loop: vote_form

  - story: starts voting form but deny adding a new comment
    steps:
      - checkpoint: starts_voting
      - slot_was_set:
        - conversation_id
      - action: vote_form
      - active_loop: vote_form
      - slot_was_set:
        - comment_confirmation: NÃ£o
      - action: utter_go_back_to_voting
      - action: vote_form
      - active_loop: vote_form

  - story: starts voting form and needs authentication
    steps:
      - checkpoint: starts_voting
      - slot_was_set:
        - conversation_id
      - action: vote_form
      - active_loop: vote_form
      - slot_was_set:
        - user_can_vote: False
      - checkpoint: need_authentication

  - story: Goodbye happy path
    steps:
      - action: utter_thanks_participation
      - action: utter_next_conversation
      - action: utter_finish
      - action: action_session_start
