version: "2.0"

stories:
  - story: Greet user in individual chat
    steps:
      - intent: start
      - action: action_set_channel_info
      - action: action_get_conversation_info
      - action: utter_show_topic_of_discussion
      - action: utter_ask_user_particpate
      - checkpoint: check_start_interaction

  - story: Explains user participation after they agreed and get current channel info
    steps:
      - checkpoint: check_start_interaction
      - intent: agree
      - action: utter_agreed_participation
      - action: utter_ask_email
      - action: utter_explain_ask_email
      - action: utter_email_is_optional
      - action: utter_send_email
      - checkpoint: check_explain_participation

  - story: Activate vote form with user email
    steps:
      - checkpoint: check_explain_participation
      - or:
        - intent: disagree
        - intent: email
          entities:
            - email
      - action: action_setup_conversation
      - action: utter_stop_conversation
      - action: vote_form
      - active_loop: vote_form
      - active_loop: null
      - action: action_follow_up_form
      - action: utter_thanks_participation
      - action: utter_goodbye
      - action: utter_next_conversation
      - action: utter_finish
      - action: action_session_start

  - story: User don't want to participate sad path
    steps:
      - checkpoint: check_start_interaction
      - intent: disagree
      - action: utter_disagreed_participation
      - action: utter_stopped
      - action: utter_next_conversation
      - action: utter_finish
      - action: action_session_start

  - story: Generate group interaction in telegram
    steps:
      - intent: start
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: utter_welcome
      - intent: start_group_interaction
      - action: utter_send_telegram_generated_url

  - story: Participate on default conversation after generated link
    steps:
      - intent: start_group_interaction
      - action: utter_send_telegram_generated_url
      - intent: participate_on_telegram
      - action: action_get_conversation_info
      - action: utter_show_topic_of_discussion
      - action: utter_ask_user_particpate

  - story: Start conversation in telegram as another channels
    steps:
      - intent: start
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: utter_welcome
      - intent: participate_on_telegram
      - action: action_get_conversation_info
      - action: utter_show_topic_of_discussion
      - action: utter_ask_user_particpate

  - story: Start conversation from telegram without payload
    # When someone starts a conversation with the bot on telegram
    # it always sends a "start" message
    steps:
      - intent: start_with_conversation_id
      - slot_was_set:
        - conversation_id: null
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: utter_welcome

  - story: Start conversation from telegram link
  # When using a link with a payload user send to bot a message
  # start [payload]. We use it to set conversation_id
    steps:
      - intent: start_with_conversation_id
      - slot_was_set:
        - conversation_id
      - action: action_set_channel_info
      - slot_was_set:
        - current_channel_info: 'telegram'
      - action: action_get_conversation_info
      - action: utter_show_topic_of_discussion
      - action: utter_ask_user_particpate
      - intent: agree
      - action: utter_agreed_participation
      - action: utter_ask_email
      - action: utter_explain_ask_email
      - action: utter_email_is_optional
      - action: utter_send_email

  - story: User provides invalid email
    steps:
      - intent: invalid_email
      - action: utter_invalid_email
      - action: utter_ask_email_again
      - intent: email
        entities:
          - email
      - action: action_setup_conversation
      - action: utter_stop_conversation
      - action: vote_form
      - active_loop: vote_form
      - active_loop: null
      - action: action_follow_up_form
      - action: utter_thanks_participation
      - action: utter_goodbye
      - action: utter_next_conversation
      - action: utter_finish
      - action: action_session_start

  - story: Goodbye happy path
    steps:
      - action: utter_thanks_participation
      - action: utter_goodbye
      - action: utter_next_conversation
      - action: utter_finish
      - action: action_session_start
